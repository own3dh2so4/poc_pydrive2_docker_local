# Example of PyDrive2 dockerized app using OAuth

This repository is an example of PyDrive2 app in docker, with the intention of running this container on the local machine.

Because OAuth2 is based on a lot of steps, it is complicated handing the communication between Google, your laptop and Docker.

In this repository I added a workaround that must works in Linux and Mac.

First of all you need read the [PyDrive2 doc](https://docs.iterative.ai/PyDrive2/), and create your Google project.

## Explanation

This solution is based in not execute directly the docker image that contains the PyDrive2 program, we create a wrapper
called `main` in `\bin` folder.

### bin/main file

This file will invoke in background `local_nc` and before will invoke the docker image with the pydrive2 code.

### bin/local_nc

This file contain the workaround. Before starting explaining this file we must know that the URLs generated by Google
for OAuth can be predictable with the following format:

```
"https://accounts.google.com/o/oauth2/auth/oauthchooseaccount?client_id=<CLIENT_ID>&redirect_uri=<REDIRECT_URI>&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive&access_type=online&response_type=code&service=lso&o2v=1&flowName=GeneralOAuthFlow"
```

What does this script do? This script runs a docker image with `nc` command waiting for request to the redirect localhost
URL, the output of `nc` is stored in a temporal file (This file will be used as communication mechanism with the
PyDrive2 docker app). After launching the `nc` command, the script will open the Google OAuth URL in the browser and
will wait for response in `nc`. When the code provide by Google is logged in the temporal file, this script will stop
the docker container with nc and will end.

### main.py

This is a simple PyDrive2 script that instead of use the common `gauth.LocalWebserverAuth()` will use a custom flow. The
workflow is wait for the code send by Google in the temporal file created by the `nc` command of `bin/local_nc`

## Execution example:

```shell
$ Please open in your browser: https://accounts.google.com/o/oauth2/auth?client_id=<>.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2F&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive&access_type=online&response_type=code
Authentication successful.
title: Take the control of brand protection in your AWS Lambda, id: <some_id>
title: pdf_sol_cpr, id: <some_id>
title: pdf_sol_cpr.pdf, id: <some_id>

```
